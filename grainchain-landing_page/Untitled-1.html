<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GrainChain — Donor Frontend (Demo)</title>
  <style>
    :root{--accent:#1f9d55;--muted:#6b7280;--bg:#f7faf6;--card:#ffffff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:var(--bg);color:#0f172a}
    header{background:linear-gradient(90deg,#083b25 0%, #0b6b43 100%);color:white;padding:18px 28px;display:flex;align-items:center;justify-content:space-between}
    header .brand{font-weight:700;letter-spacing:0.2px}
    .container{max-width:1100px;margin:26px auto;padding:0 16px}

    /* landing */
    .hero{display:flex;gap:28px;align-items:center}
    .hero-left{flex:1}
    .hero h1{margin:0 0 12px;font-size:32px}
    .hero p{margin:0 0 18px;color:var(--muted)}
    .cta-btn{background:var(--accent);border:none;color:white;padding:12px 18px;border-radius:10px;font-weight:600;cursor:pointer}
    .muted-cta{background:transparent;border:2px solid rgba(255,255,255,0.18);color:white;padding:10px 16px;border-radius:10px;cursor:pointer}

    /* cards and forms */
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .cols{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .hidden{display:none}
    form input, form select, form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;margin-top:8px}
    label{display:block;font-size:14px;margin-top:12px}
    .small{font-size:13px;color:var(--muted)}

    /* nav (dashboard) */
    nav.side{width:240px;padding:18px;background:linear-gradient(180deg,#ffffff,#f6fbf6);border-radius:12px}
    nav.side ul{list-style:none;padding:0;margin:0}
    nav.side li{padding:12px;border-radius:8px;cursor:pointer;margin-bottom:8px}
    nav.side li.active{background:rgba(31,157,85,0.12);font-weight:600}

    /* dashboard layout */
    .dash-wrap{display:grid;grid-template-columns:240px 1fr;gap:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .points-badge{background:#e6f9ec;color:var(--accent);padding:8px 12px;border-radius:999px;font-weight:600}

    .donation-item{display:flex;justify-content:space-between;padding:12px;border-radius:8px;border:1px dashed #e6e9ef;margin-top:10px}
    .donation-item .meta{font-size:14px}
    .donation-item .status{font-weight:700}

    footer{margin:36px 0;color:var(--muted);text-align:center}

    /* responsive */
    @media (max-width:900px){
      .cols{grid-template-columns:1fr}
      .dash-wrap{grid-template-columns:1fr}
      nav.side{display:flex;gap:8px;overflow:auto}
      nav.side li{white-space:nowrap}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">GrainChain</div>
    <div style="display:flex;gap:10px;align-items:center">
      <button id="nav-login" class="muted-cta">Login</button>
      <button id="nav-signup" class="cta-btn">Sign Up</button>
    </div>
  </header>

  <main class="container">
    <!-- Landing -->
    <section id="landing" class="card">
      <div class="hero">
        <div class="hero-left">
          <h1>Donate surplus food fast. Help people faster.</h1>
          <p>Quickly list what you have. We’ll try our best (and some algorithms) to connect it to an NGO that can pick it up — before it goes bad.</p>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button class="cta-btn" id="landing-signup">Sign up</button>
            <button class="muted-cta" id="landing-login">Login</button>
          </div>
          <p class="small" style="margin-top:12px">This is a frontend demo. Later we'll hook up Google Maps, spoilage checks and a backend.</p>
        </div>
        <div style="width:360px">
          <div class="card">
            <h3 style="margin-top:0">Quick demo — donate in 60s</h3>
            <p class="small">Use the Sign up button to create a local demo account. Everything is saved in your browser for now.</p>
            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="cta-btn" id="demo-donate">Create Demo Donation</button>
              <button class="muted-cta" id="demo-reset">Reset Local Data</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Signup -->
    <section id="signup" class="card hidden">
      <h2>Create account</h2>
      <form id="signup-form">
        <label>Name<input type="text" id="su-name" required /></label>
        <label>Email<input type="email" id="su-email" required /></label>
        <label>Password<input type="password" id="su-pass" required minlength="6"/></label>
        <label>Phone (optional)<input type="tel" id="su-phone"/></label>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="cta-btn" type="submit">Sign up</button>
          <button type="button" id="su-cancel" class="muted-cta">Cancel</button>
        </div>
      </form>
    </section>

    <!-- Login -->
    <section id="login" class="card hidden">
      <h2>Login</h2>
      <form id="login-form">
        <label>Email<input type="email" id="li-email" required /></label>
        <label>Password<input type="password" id="li-pass" required/></label>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="cta-btn" type="submit">Sign in</button>
          <button type="button" id="li-cancel" class="muted-cta">Cancel</button>
        </div>
      </form>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="hidden">
      <div class="dash-wrap">
        <nav class="side card">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
            <div style="width:56px;height:56px;border-radius:999px;background:linear-gradient(180deg,#e6fff0,#ccf6df);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)">D</div>
            <div>
              <div id="profile-name">Donor</div>
              <div class="small" id="profile-email">email@example.com</div>
            </div>
          </div>
          <ul>
            <li class="active" data-tab="new-donation">New donation</li>
            <li data-tab="history">Donation history</li>
            <li data-tab="points">Earned points</li>
            <li data-tab="profile">Profile update</li>
            <li id="logout-btn">Logout</li>
          </ul>
        </nav>

        <div>
          <div class="topbar">
            <div class="card" style="flex:1">Welcome back, <strong id="top-username">Donor</strong></div>
            <div style="display:flex;gap:12px;align-items:center">
              <div class="points-badge">Points: <span id="points-count">0</span></div>
            </div>
          </div>

          <div id="tab-area">
            <div id="new-donation" class="card tab-content">
              <h3>New donation</h3>
              <form id="donation-form">
                <label>Food item<textarea id="fd-item" rows="2" placeholder="e.g. 3x lunch boxes - rice, curry" required></textarea></label>
                <label>Quantity (approx.)<input id="fd-qty" required /></label>
                <label>Available until (datetime)<input type="datetime-local" id="fd-until" required /></label>
                <label>Storage mode
                  <select id="fd-storage">
                    <option value="fridge">Fridge / Cold</option>
                    <option value="open">Open / Room temp</option>
                    <option value="hot">Hot / Freshly cooked</option>
                    <option value="sealed">Sealed / Vacuum packed</option>
                  </select>
                </label>
                <label>Pickup location (address) <input id="fd-location" placeholder="Address or landmark"/></label>
                <label>Notes <input id="fd-notes" placeholder="Allergens, reheating instructions (optional)"/></label>
                <div style="display:flex;gap:8px;margin-top:12px">
                  <button class="cta-btn" type="submit">Publish donation</button>
                  <button type="button" id="don-calc" class="muted-cta">Check spoilage & ETA (sim)</button>
                </div>
                <p class="small" style="margin-top:6px">Spoilage & ETA is currently simulated here. Later you'll replace this with real Google Maps ETA + durability model API calls.</p>
              </form>

              <div id="donation-preview" style="margin-top:14px"></div>
            </div>

            <div id="history" class="card tab-content hidden">
              <h3>Donation history</h3>
              <div id="history-list" class="small"></div>
            </div>

            <div id="points" class="card tab-content hidden">
              <h3>Earned points</h3>
              <p>You get <strong>10 points</strong> for each published donation and <strong>50 points</strong> when a donation is successfully collected by an NGO (simulated).</p>
              <div style="margin-top:10px">
                <button id="redeem-btn" class="muted-cta">Redeem points (demo)</button>
              </div>
            </div>

            <div id="profile" class="card tab-content hidden">
              <h3>Profile</h3>
              <form id="profile-form">
                <label>Name<input id="pf-name"/></label>
                <label>Email<input id="pf-email" disabled/></label>
                <label>Phone<input id="pf-phone"/></label>
                <label>Address<textarea id="pf-address" rows="2"></textarea></label>
                <div style="display:flex;gap:8px;margin-top:12px">
                  <button class="cta-btn" type="submit">Save profile</button>
                </div>
              </form>
            </div>

          </div>

        </div>
      </div>
    </section>

    <footer class="small">Front-end demo: GrainChain. No backend hooked. Data stored in browser localStorage.</footer>
  </main>

  <script>
    /* Simple single-file frontend prototype
       - LocalStorage based demo for signup/login, donations, points
       - Placeholder functions where you'll hook Google Maps & backend
    */

    // Utilities
    const $ = id => document.getElementById(id);
    const show = el => el.classList.remove('hidden');
    const hide = el => el.classList.add('hidden');

    // Sections
    const landing = $('landing');
    const signup = $('signup');
    const login = $('login');
    const dashboard = $('dashboard');

    // Navigation buttons
    $('nav-signup').addEventListener('click',()=>openSection('signup'));
    $('nav-login').addEventListener('click',()=>openSection('login'));
    $('landing-signup').addEventListener('click',()=>openSection('signup'));
    $('landing-login').addEventListener('click',()=>openSection('login'));
    $('su-cancel').addEventListener('click',()=>openSection('landing'));
    $('li-cancel').addEventListener('click',()=>openSection('landing'));

    function openSection(name){
      [landing, signup, login, dashboard].forEach(s=>s.classList.add('hidden'));
      if(name==='landing') show(landing);
      if(name==='signup') show(signup);
      if(name==='login') show(login);
      if(name==='dashboard') show(dashboard);
    }

    // LocalStorage keys and helpers
    const LS_USERS = 'gc_users';
    const LS_SESSION = 'gc_session';

    const readUsers = ()=> JSON.parse(localStorage.getItem(LS_USERS)||'{}');
    const writeUsers = (u)=> localStorage.setItem(LS_USERS, JSON.stringify(u));
    const setSession = (email)=> localStorage.setItem(LS_SESSION, email);
    const clearSession = ()=> localStorage.removeItem(LS_SESSION);
    const getSession = ()=> localStorage.getItem(LS_SESSION);

    // Signup
    $('signup-form').addEventListener('submit', e=>{
      e.preventDefault();
      const name = $('su-name').value.trim();
      const email = $('su-email').value.trim().toLowerCase();
      const pass = $('su-pass').value;
      const phone = $('su-phone').value.trim();
      if(!name||!email||!pass) return alert('Fill required fields');
      const users = readUsers();
      if(users[email]) return alert('An account with this email exists.');
      users[email] = {name,email,pass,phone,points:0,donations:[],profile:{address:''}};
      writeUsers(users);
      setSession(email);
      bootstrapDashboard();
      openSection('dashboard');
    });

    // Login
    $('login-form').addEventListener('submit', e=>{
      e.preventDefault();
      const email = $('li-email').value.trim().toLowerCase();
      const pass = $('li-pass').value;
      const users = readUsers();
      const u = users[email];
      if(!u || u.pass !== pass) return alert('Invalid credentials');
      setSession(email);
      bootstrapDashboard();
      openSection('dashboard');
    });

    // Demo reset / quick donation
    $('demo-reset').addEventListener('click',()=>{
      if(confirm('Clear demo data from browser?')){
        localStorage.clear(); location.reload();
      }
    });
    $('demo-donate').addEventListener('click',()=>{
      // create quick demo account if missing
      const users = readUsers();
      const demoEmail = 'demo@grainchain.local';
      if(!users[demoEmail]){
        users[demoEmail] = {name:'Demo Donor',email:demoEmail,pass:'demo123',phone:'',points:0,donations:[],profile:{address:'Demo Lane'}};
        writeUsers(users);
      }
      setSession(demoEmail);
      bootstrapDashboard();
      openSection('dashboard');
      // create sample donation
      createDonation({item:'3x lunch boxes (rice + veg)',qty:'3 boxes',until:new Date(Date.now()+3*3600*1000).toISOString(),storage:'open',location:'Near Main St',notes:'No peanuts'})
        .then(()=> alert('Demo donation created. Check your Donation History tab.'));
    });

    // Dashboard boot
    function bootstrapDashboard(){
      const email = getSession();
      if(!email) return openSection('landing');
      const users = readUsers();
      const u = users[email];
      if(!u) return openSection('landing');
      $('profile-name').textContent = u.name;
      $('profile-email').textContent = u.email;
      $('top-username').textContent = u.name.split(' ')[0];
      $('points-count').textContent = u.points||0;
      // load profile form
      $('pf-name').value = u.name;
      $('pf-email').value = u.email;
      $('pf-phone').value = u.phone||'';
      $('pf-address').value = (u.profile && u.profile.address) || '';
      renderHistory();
    }

    // Tabs handling
    document.querySelectorAll('nav.side li').forEach(li=>{
      li.addEventListener('click',()=>{
        document.querySelectorAll('nav.side li').forEach(x=>x.classList.remove('active'));
        li.classList.add('active');
        const tab = li.dataset.tab;
        document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.add('hidden'));
        if(tab) $(tab).classList.remove('hidden');
      });
    });

    // Logout
    $('logout-btn').addEventListener('click',()=>{ clearSession(); openSection('landing'); });

    // Donation creation
    $('donation-form').addEventListener('submit', async e=>{
      e.preventDefault();
      const item = $('fd-item').value.trim();
      const qty = $('fd-qty').value.trim();
      const until = $('fd-until').value;
      const storage = $('fd-storage').value;
      const location = $('fd-location').value.trim();
      const notes = $('fd-notes').value.trim();
      if(!item||!qty||!until) return alert('Fill required fields');
      // create donation and save to user
      await createDonation({item,qty,until,storage,location,notes});
      // award points for publishing
      awardPoints(10);
      $('donation-form').reset();
      renderHistory();
      alert('Donation published (demo).');
    });

    async function createDonation(data){
      const email = getSession();
      if(!email) return alert('Not logged in');
      const users = readUsers();
      const u = users[email];
      const id = 'don_' + Math.random().toString(36).slice(2,9);
      const now = new Date().toISOString();
      const donation = Object.assign({id,createdAt:now,status:'published'}, data);
      // store in user's donations
      u.donations = u.donations || [];
      u.donations.unshift(donation);
      users[email] = u;
      writeUsers(users);
      // simulate background event: after some time mark as collected (only demo)
      setTimeout(()=>simulateCollection(email, donation.id), 8000);
      return donation;
    }

    function renderHistory(){
      const email = getSession(); if(!email) return;
      const users = readUsers(); const u = users[email];
      const list = $('history-list'); list.innerHTML='';
      if(!u.donations || u.donations.length===0) { list.innerHTML='<div class="small">No donations yet.</div>'; return; }
      u.donations.forEach(d=>{
        const untilText = new Date(d.until).toLocaleString();
        const el = document.createElement('div'); el.className='donation-item';
        el.innerHTML = `<div class="meta"><strong>${escapeHtml(d.item)}</strong><div class="small">${escapeHtml(d.qty)} • until ${untilText}${d.location?(' • '+escapeHtml(d.location)):''}</div></div><div><div class="status">${d.status}</div></div>`;
        list.appendChild(el);
      });
      // update points badge
      $('points-count').textContent = u.points||0;
    }

    // simple spoilage & ETA simulator
    $('don-calc').addEventListener('click',()=>{
      const storage = $('fd-storage').value;
      const until = $('fd-until').value;
      const now = new Date();
      const untilT = new Date(until);
      const hoursLeft = Math.max(0, Math.round((untilT-now)/3600000));
      const spoilEstimate = estimateSpoilage(storage, hoursLeft);
      const etaSim = Math.max(10, Math.min(120, Math.round(Math.random()*90)+15)); // minutes (demo)
      const msg = `Simulated: ETA to nearest pickup ~ ${etaSim} min. Estimated freshness: ${spoilEstimate}. Hours until listed expiry: ${hoursLeft}h.`;
      alert(msg);
    });

    // Spoilage model (very simple) — replace with real model/api later
    function estimateSpoilage(storage, hoursLeft){
      // rules: fridge > sealed > hot > open
      let base = 50; // higher = better
      if(storage==='fridge') base += 40;
      if(storage==='sealed') base += 20;
      if(storage==='hot') base += 0;
      if(storage==='open') base -= 20;
      // reduce with hours left
      base -= Math.max(0, hoursLeft-2)*5;
      if(base>80) return 'Very fresh';
      if(base>55) return 'Good';
      if(base>35) return 'Use soon';
      return 'Likely spoiled soon';
    }

    // simulate NGO collection (demo): updates donation status and awards points
    function simulateCollection(userEmail, donationId){
      const users = readUsers(); const u = users[userEmail];
      if(!u) return;
      const idx = u.donations.findIndex(d=>d.id===donationId);
      if(idx===-1) return;
      // if already expired or past 'until', mark failed
      const donation = u.donations[idx];
      const until = new Date(donation.until);
      const now = new Date();
      // 60% chance collected if not past until, else fail
      const collected = now <= until ? Math.random()<0.6 : Math.random()<0.15;
      donation.status = collected ? 'collected' : (now>until ? 'expired' : 'uncollected');
      users[userEmail].donations[idx] = donation; users[userEmail].points = (users[userEmail].points||0) + (collected?50:0);
      writeUsers(users);
      if(collected) alert('Your donation was collected! +50 points (demo).');
      renderHistory();
    }

    // Award points helper
    function awardPoints(n){
      const email = getSession(); if(!email) return;
      const users = readUsers(); users[email].points = (users[email].points||0) + n; writeUsers(users); $('points-count').textContent = users[email].points;
    }

    // Profile save
    $('profile-form').addEventListener('submit', e=>{
      e.preventDefault();
      const email = getSession(); if(!email) return;
      const users = readUsers(); const u = users[email];
      u.name = $('pf-name').value.trim() || u.name;
      u.phone = $('pf-phone').value.trim();
      u.profile = u.profile || {};
      u.profile.address = $('pf-address').value.trim();
      users[email] = u; writeUsers(users); bootstrapDashboard(); alert('Profile saved.');
    });

    // Points redeem (demo)
    $('redeem-btn').addEventListener('click', ()=>{
      const email = getSession(); if(!email) return;
      const users = readUsers(); const u = users[email];
      if((u.points||0) < 100) return alert('You need 100 points to redeem demo reward.');
      u.points -= 100; writeUsers(users); bootstrapDashboard(); alert('Redeemed 100 points (demo).');
    });

    // small helper
    function escapeHtml(text){ return (text+'').replace(/[&<>\"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[s]); }

    // simulate collection button? none

    // initial view: if session exists go to dashboard
    if(getSession()){
      bootstrapDashboard(); openSection('dashboard');
    } else {
      openSection('landing');
    }

    // small helper for demo reset on page unload — disabled by default
    // window.addEventListener('beforeunload', ()=>localStorage.removeItem('gc_users'));

    // Where to hook Google Maps & backend:
    // - Replace the location input with a Maps Autocomplete widget (Google Places) and supply lat/lng
    // - When creating donation, call backend API POST /donations with full payload; backend then queries ETA using Maps Distance Matrix and a spoilage microservice
    // - Replace the estimateSpoilage() with an API call to your durability model, passing storage mode, temperature, distance, ETA

  </script>
</body>
</html>
